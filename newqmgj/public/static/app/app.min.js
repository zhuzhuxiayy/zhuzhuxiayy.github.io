var app = angular.module('qmgj_unlogin',['ui.router']);
app.config(['$stateProvider','$urlRouterProvider',function($stateProvider,$urlRouterProvider){
	$urlRouterProvider.otherwise('/login');
	$stateProvider.state('home',{
		url:'/home',
		templateUrl:'static/app/view/homeView.html',
		controller:'homeController'
	}).state('reg',{
		url:'/reg',
		templateUrl:'static/app/view/regView.html',
		controller:'regController'
	}).state('login',{
		url:'/login',
		templateUrl:'static/app/view/loginView.html',
		controller:'loginController'
	})
}]);

app.filter('getMoon',function(){
	return function(input){
		var curH = new Date(parseInt(input)).getHours();
		var moon = '';
		if (curH>6 && curH<12) {
			moon = '早上';
		}
		else if (curH>=12 && curH<14) {
			moon = '中午';
		}
		else if (curH>=14 && curH<18) {
			moon = '下午';
		}
		else if (curH>=18 && curH<24) {
			moon = '晚上';
		}
		else{
			moon = '凌晨';
		}
		return moon;
	}
})

app.filter('substr',function(){
	return function(){
		var val = arguments[0] || '',
		start = arguments[1],
		count = arguments[2];
		if (count == undefined) {
			count = arguments[1];
			start = 0;
		}
		if (start == undefined) {
			start = 0;
			count = val.length;
		}
		return val.substr(start,count);
	}
})
var app2 = angular.module('qmgj_login',['ui.router','ui.bootstrap']);
app2.config(['$stateProvider','$urlRouterProvider',function($stateProvider,$urlRouterProvider){
	$urlRouterProvider.otherwise('/home');
	$stateProvider.state('home',{
		url:'/home',
		templateUrl:'static/app/view/homeView.html',
		controller:'homeController'
	}).state('vip',{
		url:'/vip',
		templateUrl:'static/app/view/vipView.html',
		controller:'vipController'
	}).state('vip.main',{
		url:'/main',
		templateUrl:'static/app/view/vipMainView.html',
		controller:'vipMainController'
	}).state('vip.info',{
		url:'/info',
		templateUrl:'static/app/view/vipInfoView.html',
		controller:'vipInfoController'
	}).state('vip.record',{
		url:'/record',
		templateUrl:'static/app/view/vipRecordView.html',
		controller:'vipRecordController'
	}).state('list',{
		url:'/list',
		templateUrl:'static/app/view/listView.html',
		controller:'listController'
	}).state('list2',{
		url:'/list/:keyword',
		templateUrl:'static/app/view/listView.html',
		controller:'listController'
	})
}]);

app2.filter('getMoon',function(){
	return function(input){
		var curH = new Date(parseInt(input)).getHours();
		var moon = '';
		if (curH>6 && curH<12) {
			moon = '早上';
		}
		else if (curH>=12 && curH<14) {
			moon = '中午';
		}
		else if (curH>=14 && curH<18) {
			moon = '下午';
		}
		else if (curH>=18 && curH<24) {
			moon = '晚上';
		}
		else{
			moon = '凌晨';
		}
		return moon;
	}
})

app2.filter('substr',function(){
	return function(){
		var val = arguments[0] || '',
		start = arguments[1],
		count = arguments[2];
		if (count == undefined) {
			count = arguments[1];
			start = 0;
		}
		if (start == undefined) {
			start = 0;
			count = val.length;
		}
		return val.substr(start,count);
	}
})
app.controller('homeController', ['$scope', '$http', '$interval', dealHome]);
app2.controller('homeController', ['$scope', '$http', '$interval', dealHome]);

function dealHome($scope, $http, $interval) {
    $scope.hotNav = ['', '微电影', '电视剧', '话剧', '电影', '戏曲', '书画', '相声', '戏剧', '音乐剧'];
    $scope.tvData = [];
    var Home = {
        init: function() {
            var that = this;
            $http({
                url: '/IndexInfo',
                method: 'get'
            }).then(function(res) {
                if (res.data.resultCode == '0000') {
                    that.dealSlide(res.data.result.slides); //轮播图处理
                    that.dealHot(res.data.result.hot); // 热门项目
                    that.dealTV(res.data.result.new); // 卫视主推
                    that.dealUnit(res.data.result.unit); // 合作单位
                }
            })
        },
        dealSlide: function(slideData) {
            $scope.slideData = slideData;
            $scope.showIndex = 0;
            var inter = $interval(function() {
                $scope.showIndex++;
                if ($scope.showIndex == $scope.slideData.length) {
                    $scope.showIndex = 0;
                }
            }, 1500);

            $scope.pauseSlide = function(index) {
                $interval.cancel(inter);
                $scope.showIndex = index;
            }

            $scope.playSlide = function() {
                inter = $interval(function() {
                    $scope.showIndex++;
                    if ($scope.showIndex == $scope.slideData.length) {
                        $scope.showIndex = 0;
                    }
                }, 1500);
            }
        },
        dealHot: function(hotData) {
            $scope.hotData = hotData;
            $scope.hotItem = hotData[0];
            $scope.hotIndex = 0;
            $scope.showHotItem = function(index) {
                $scope.hotIndex = index;
                $scope.hotItem = res.data.result.hot[index];
            }
        },
        dealTV: function(tvData) {
        	$scope.tvData = tvData;
        },
        dealUnit: function(unitData) {
        	$scope.unitData = unitData;
        }
    }
    Home.init();
}

app.controller('listController', ['$scope', '$http', '$stateParams', myListController]);
app2.controller('listController', ['$scope', '$http', '$stateParams', myListController]);

function myListController($scope, $http, $stateParams) {
    var List = {
        init: function() {
        	// console.log($stateParams.keyword);
            $scope.cipArr = ['全部', '微电影', '电视剧', '话剧', '电影', '戏曲', '书画', '相声', '戏剧', '音乐剧', '其它'];
            $scope.cip2Arr = ['筹资中', '已结束', '成功'];
            $scope.cip3Arr = ['最新', '热门', '结束时间'];

            $scope.type = 0;
            $scope.status = 0;
            $scope.timeStatus = 0;

            $scope.countAll = 0;
            $scope.maxSize = 10;
            $scope.page = 1;
            $scope.count = 3;
            $scope.keyword = '';

            if ( $stateParams.keyword != undefined) {
            	$scope.keyword = $stateParams.keyword;
            }

            this.events();
            this.getListData();
        },
        events: function() {
        	var that = this;
            $scope.changeType = function(index) {
                $scope.type = index;
                $scope.page = 1;
                that.getListData();
            }
            $scope.changeStatus = function(index) {
                $scope.status = index;
                $scope.page = 1;
                that.getListData();
            }
            $scope.checkTimeStatus = function(index) {
                $scope.timeStatus = index;
                $scope.page = 1;
                that.getListData();
            }
            $scope.pageChanged = function() {
                console.log($scope.page);
                that.getListData();
            }
        },
        getListData: function() {
            $http({
                url: '/prolist',
                method: 'get',
                params: {
                    keyword: $scope.keyword, // 关键字搜索， 选填
                    cid: $scope.type ,// 数组下标 ['全部','微电影','电视剧','话剧','电影','戏曲','书画','相声','戏剧','音乐剧','其它']
                    status: $scope.status ,// 0 筹资中  1已结束  2成功
                    timeStatus: $scope.timeStatus ,// 0最新  1热门  2结束时间
                    page: $scope.page ,// 第1页数据  默认第1页
                    count: $scope.count // 一页9条数据
                }
            }).then(function(res) {
                // console.log('list---', res);
                if (res.data.resultCode == '0000') {
                	$scope.listData = res.data.result.list;
                	$scope.countAll = res.data.result.countAll;
                	$scope.count = res.data.result.count;
                }
            })
        }
    }
    List.init();
}

app.controller('loginController', ['$scope', '$http', '$state', function($scope, $http, $state) {
    $scope.loginClick = function() {
        if ($scope.myform.$valid) {
            $http({
                url: '/user/login',
                method: 'post',
                data: {
                    phone: $scope.phone,
                    password: $scope.pwd
                }
            }).then(function(res) {
                console.log(res);
                if (res.data.resultCode == '0000') {
                    alert('登陆成功');
                    location.reload();
                }else{
                	console.log(res.data.resultMsg);
                }
            })
        }
    }

}])

app2.controller('logoutController',['$scope','$http',function($scope,$http){
	$scope.userLogout = function(){
		$http({
			url:'/user/logout'
		}).then(function(res){
			// console.log('logout->',res);
			if (res.data.resultCode == '0000') {
				alert('退出成功');
				location.reload();
			}
		})
	}
}])
app.controller('regController',['$scope','$http','$state',function($scope,$http,$state){
	$scope.regClick = function(){
		$http({
			url:'/user/reg',
			method:'post',
			data:{
				name:$scope.username,
				phone:$scope.phone,
				password:$scope.pwd,
				passwordRepeat:$scope.pwd2
			}
		}).then(function(res){
			console.log('reg->',res);
			if (res.data.resultCode == '0000') {
				alert('注册成功');
				$state.go('login');
			}else{
				console.log(res.data.resultMsg);
			}
		})
	}
}])
app.controller('searchController',['$scope','$state',dealSearch]);
app2.controller('searchController',['$scope','$state',dealSearch]);
function dealSearch($scope,$state){
	$scope.myKeyUp = function(e){
		var keycode = window.event ? e.keyCode : e.which;
		if (keycode == 13) {
			// 可用两种方式获取input的value值
			console.log($scope.inputValue);
			console.log(angular.element(e.target).val());
			$state.go('list2',{keyword:$scope.inputValue});
		}
	}
}
app2.controller('vipController',['$scope','$http',function($scope,$http){
	$http({
		url:'static/app/json/userinfo.json'
	}).then(function(res){
		if (res.data.resultCode == '0000') {
			$scope.vipData = res.data.result;
		}
	})
}])
app2.controller('vipInfoController',['$scope',function($scope){
	$scope.cipArr = ['微电影','电视剧','话剧','电影','戏曲','书画','相声','戏剧','音乐剧'];
	$scope.fileNameChanged = function(event){
		console.log(event);
	}
	$scope.radio = function(e){
		var ngDom = angular.element(e.target);
		ngDom.parent().children().removeClass('active');
		ngDom.addClass('active');
	}
	$scope.checkbox = function(e){
		var ngDom = angular.element(e.target);
		ngDom.toggleClass('active');
	}
	$scope.submit = function(){
		var radioDom = angular.element(document.querySelectorAll('.info-radio.active'));
		console.log('性别->',radioDom.attr('data-value'));
		var checkboxDom = angular.element(document.querySelectorAll('.info-checkbox.active'));
		var arr = [];
		for (var i = 0; i < checkboxDom.length; i++) {
			arr.push(checkboxDom.eq(i).attr('data-value'));
		}
		console.log('关注的圈子->',arr.toString());
		var dataObj = {
			gender:radioDom.attr('data-value'),
			attention:arr.toString()
		}
	}
}])
app2.controller('vipMainController',['$scope','$http',function($scope,$http){
	$http({
		url:'static/app/json/procare.json'
	}).then(function(res){
		if (res.data.resultCode == '0000') {
			$scope.careData = res.data.result.procare;
			$scope.hotData = res.data.result.prohot;
		}
	})
}])
app2.controller('vipRecordController', ['$scope', '$http', function($scope, $http) {
    var Record = {
        init: function() {
        	$scope.type = 0; //0:全部 1：未支付 2：已支付
        	$scope.countAll = 0; //默认0条数据
        	$scope.maxSize = 10;
        	$scope.page = 1;
        	$scope.count = 5;

        	this.events();
        	this.getRecordData();
        },
        events: function() {
        	var that = this;
        	$scope.pageChanged = function(){
        		console.log($scopoe.page);
        		that.getRecordData();
        	}
        	$scope.changeType = function(index){
        		$scope.type = index;
        		that.getRecordData();
        	}
        },
        getRecordData: function() {
            $http({
                url: '/user/RecordList',
                method: 'post',
                data: {
                    type: $scope.type,
                    page: $scope.page,
                    count: $scope.count
                }
            }).then(function(res) {
                console.log(res);
                if (res.data.resultCode == '0000') {
                    $scope.recordData = res.data.result.list;
                    $scope.countAll = res.data.result.count;
                } else {
                    alert(res.data.resultMsg);
                }
            })
        }
    }
    Record.init();
}])
